version: "3"
volumes:
  config:
    driver: local
  logs:
    driver: local
services:
  <dir>-server:
    image: <dir>-server:latest
    build: ./<dir>-server
    restart: always
    environment:
      - SERVER=${SERVER:-docker}
    volumes:
      - config:/config:rw
      - logs:/usr/src/<dir>-server/logs
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"
  <dir>-ui:
    depends_on:
      - <dir>-server
    image: <dir>-ui:latest
    build: ./<dir>-ui
    restart: always
    environment:
      - NODE_ENV=${NODE_ENV:-production}
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"
  nginx:
    depends_on:
      - <dir>-ui
      - <dir>-server
    image: <dir>-nginx:latest
    build: ./nginx-docker
    restart: always
    ports:
      - 80:80
      - 443:443
    volumes:
      - ./nginx-docker/ssl:/tmp/ssl:ro
    environment:
      - SSL=${SSL:-false}
      - SSL_CERT_TYPE=${SSL_CERT_TYPE:-crt}
    logging:
      driver: "json-file"
      options:
        max-size: "100m"
        max-file: "3"
networks:
  default:
    external:
      name: strato_static
